<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>OAuth详解 | 技术博客</title><link rel="stylesheet" type="text/css" href="http://www.happycode.org/css/normalize.css"><link rel="stylesheet" type="text/css" href="http://www.happycode.org/css/pure-min.css"><link rel="stylesheet" type="text/css" href="http://www.happycode.org/css/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="http://www.happycode.org/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="http://www.happycode.org/favicon.ico"><link rel="apple-touch-icon" href="http://www.happycode.org/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="http://www.happycode.org/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="http://www.happycode.org/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">OAuth详解</h1><a id="logo" href="http://www.happycode.org/.">技术博客</a><p class="description">Happy Code</p></div><div id="nav-menu"><a href="http://www.happycode.org/." class="current"><i class="icon-home"> 首页</i></a><a href="http://www.happycode.org/archives/"><i class="icon-archive"> 归档</i></a><a href="http://www.happycode.org/about/"><i class="icon-about"> 关于</i></a><a href="http://www.happycode.org/atom.xml"><i class="icon-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post post-page"><h1 class="post-title">OAuth详解</h1><div class="post-meta">2016-02-21 | </div><span data-thread-key="2016/02/21/oauth/" class="ds-thread-count"></span><div class="post-content"><p>OAuth是近年来逐渐广为使用的Web服务认证协议，他所解决的是在Web服务之间共享一个身份认证的问题。</p>
<h1 id="OAuth_u540D_u8BCD_u89E3_u91CA"><a href="#OAuth_u540D_u8BCD_u89E3_u91CA" class="headerlink" title="OAuth名词解释"></a>OAuth名词解释</h1><p><em>OAuth（开放授权）是一个开放标准，允许用户让第三方应用访问该用户在某一网站上存储的私密的资源（如照片，视频，联系人列表），而无需将用户名和密码提供给第三方应用。</em></p>
<p><em>OAuth允许用户提供一个令牌，而不是用户名和密码来访问他们存放在特定服务提供者的数据。每一个令牌授权一个特定的网站（例如，视频编辑网站)在特定的时段（例如，接下来的2小时内）内访问特定的资源（例如仅仅是某一相册中的视频）。这样，OAuth让用户可以授权第三方网站访问他们存储在另外服务提供者的某些特定信息，而非所有内容。</em></p>
<p><em>OAuth是OpenID的一个补充，但是完全不同的服务。</em></p>
<p>引用自 <a href="https://zh.wikipedia.org/wiki/OAuth" target="_blank" rel="external">维基百科</a></p>
<p>以上是维基百科对OAuth的名词解释，已经非常准确和详细，关于什么是开发授权？OAuth和OpenID有什么区别？我这里再补充下：</p>
<ul>
<li><h3 id="u5C01_u95ED_u6388_u6743"><a href="#u5C01_u95ED_u6388_u6743" class="headerlink" title="封闭授权"></a>封闭授权</h3><em>系统内部用户之间的相互授权，不能支持与外部系统与用户之间的授权，如：</em></li>
</ul>
<ol>
<li>QQ空间访问权限</li>
<li>微信查看朋友圈信息权限（不让他看我的朋友圈，不看他的朋友圈）</li>
</ol>
<ul>
<li><h3 id="u5F00_u653E_u6388_u6743"><a href="#u5F00_u653E_u6388_u6743" class="headerlink" title="开放授权"></a>开放授权</h3><em>支持将系统内资源授权给第三方应用使用，但最终的权限控制掌控在用户手中，不会出现安全和隐私不可控的情况</em></li>
</ul>
<ol>
<li>支持细粒度权限控制（微信授权可以发朋友圈，可以分享给好友等社交功能）</li>
<li>不会泄露用户密码或其他认证凭证（在微信分享给好友或者发朋友圈的时候，不会用到你的微信密码）</li>
</ol>
<ul>
<li><h3 id="OAuth_u548COpenID_u6709_u4EC0_u4E48_u533A_u522B_uFF1F"><a href="#OAuth_u548COpenID_u6709_u4EC0_u4E48_u533A_u522B_uFF1F" class="headerlink" title="OAuth和OpenID有什么区别？"></a>OAuth和OpenID有什么区别？</h3><p><em>OAuth 关注的是 authorization( 授权 ) ；而 OpenID 侧重的是 authentication （认证）。</em><br>OAuth 关注的是授权，即：“用户能做什么”；而 OpenID 关注的是证明，即：“用户是谁”。</p>
<p>  纵观账号互通发展史，可以发现OAuth比起其它协议（如OpenID）更流行的原因是，业务双方不仅要求账号本身的认证互通（authentication；认证，可理解为“我在双方的地盘姓甚名谁”），而是更需要双方业务流的授权打通（authorization；授权，可理解为“我在双方的地盘上可做什么”），因为后者才能产生实际的互惠互利。</p>
<p>  总之，很多网站、APP 弱化甚至没有搭建自己的账号体系，而是直接使用社会化登录的方式，这样不仅免去了用户注册账号的麻烦、还可以获取用户的好友关系来增强自身的社交功能。</p>
</li>
</ul>
<h1 id="OAuth_u5386_u53F2"><a href="#OAuth_u5386_u53F2" class="headerlink" title="OAuth历史"></a>OAuth历史</h1><ul>
<li>2007年4月，成立OAuth讨论组并撰写了一个开放协议的提议草案。</li>
<li>2007年10月, OAuth核心1.0最后的草案发布了。</li>
<li>2009年4月23日，OAuth 1.0被爆出有安全漏洞，于是发布了OAuth 1.0a修复了这个安全漏洞。</li>
<li>2010年4月，OAuth 1.0协议发表为RFC 5849，一个非正式RFC。</li>
<li>2012年10月，OAuth 2.0协议正式发布为RFC 6749。OAuth 2.0关注客户端开发者的简易性，同时为Web应用，桌面应用和手机，和起居室设备提供专门的认证流程。</li>
</ul>
<h1 id="OAuth_u534F_u8BAE"><a href="#OAuth_u534F_u8BAE" class="headerlink" title="OAuth协议"></a>OAuth协议</h1><h3 id="u534F_u8BAE_u7684_u53C2_u4E0E_u8005"><a href="#u534F_u8BAE_u7684_u53C2_u4E0E_u8005" class="headerlink" title="协议的参与者"></a>协议的参与者</h3><ul>
<li>RO (resource owner): 资源所有者，对资源具有授权能力的人。</li>
<li>RS (resource server): 资源服务器，它存储资源，并处理对资源的访问请求。</li>
<li>Client: 第三方应用，它获得RO的授权后便可以去访问RO的资源。</li>
<li>AS (authorization server): 授权服务器，它认证RO的身份，为RO提供授权审批流程，并最终颁发授权令牌(Access Token)。</li>
</ul>
<h3 id="OAuth2-0_u4E3A_u4E86_u652F_u6301_u8FD9_u4E9B_u4E0D_u540C_u7C7B_u578B_u7684_u7B2C_u4E09_u65B9_u5E94_u7528_uFF0C_u63D0_u51FA_u4E86_u4E0B_u9762_u56DB_u79CD_u6388_u6743_u7C7B_u578B_uFF1A"><a href="#OAuth2-0_u4E3A_u4E86_u652F_u6301_u8FD9_u4E9B_u4E0D_u540C_u7C7B_u578B_u7684_u7B2C_u4E09_u65B9_u5E94_u7528_uFF0C_u63D0_u51FA_u4E86_u4E0B_u9762_u56DB_u79CD_u6388_u6743_u7C7B_u578B_uFF1A" class="headerlink" title="OAuth2.0为了支持这些不同类型的第三方应用，提出了下面四种授权类型："></a>OAuth2.0为了支持这些不同类型的第三方应用，提出了下面四种授权类型：</h3><ul>
<li>授权码 (Authorization Code Grant)，适用于有server端的应用授权。最常用的授权方式</li>
<li>隐式授权 (Implicit Grant)，适用于通过客户端访问的应用授权。适用于纯JS程序</li>
<li>资源所有者密码凭证许可 (Resource Owner Password Credentials Grant)，OAuth简化版，常用于移动应用认证，称为xAuth。在客户端高度可信且授权码流程不方便实施的情况下试用。</li>
<li>受保护资源的客户端授权 (Client Credentials Grant)。客户端高度可信，拥有被操作资源（自用型），或操作非敏感资源。</li>
</ul>
<h1 id="OAuth_u6388_u6743_u6B65_u9AA4"><a href="#OAuth_u6388_u6743_u6B65_u9AA4" class="headerlink" title="OAuth授权步骤"></a>OAuth授权步骤</h1><h3 id="Authorization_Code__u6388_u6743"><a href="#Authorization_Code__u6388_u6743" class="headerlink" title="Authorization Code 授权"></a>Authorization Code 授权</h3><ol>
<li><p>授权场景</p>
<p> Authorization code 授权适用于PC，无线客户端等需要和第三方server进行交互的应用场景。使用Authorization code授权，第三方能够集中处理用户的授权请求和授权结果，适用于有server端的应用。</p>
</li>
<li><p>授权流程</p>
<p> Authorization code授权模式分为两步，首先获取authorization code，然后用code获取acces token<br>交互图：<br><img src="http://www.happycode.org/./image/authorization-code-grant-flow.jpg" alt="authorization-code 交互图"><br>流程图<br><img src="http://www.happycode.org/./image/authorization-code-grant.png" alt="authorization-code 流程图"></p>
</li>
<li><p>过程详解</p>
<p> A. 用户访问应用，应用将用户引向认证服务器。比如唯品会想要获取QQ用户一些资源，首先将用户引向QQ的授权页面(授权服务器返回)。如下图：<br><img src="http://www.happycode.org/./image/vip-qq.jpg" alt="QQ授权登陆页"><br>应用申请认证的URL，包含以下参数：</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http<span class="variable">s:</span>//graph.qq.<span class="keyword">com</span>/oauth/show?</span><br><span class="line">which=Login&amp;<span class="keyword">display</span>=<span class="keyword">pc</span>&amp;client_id=<span class="number">100292427</span>&amp;</span><br><span class="line">redirect_uri=http<span class="variable">s:</span>//passport.vip.<span class="keyword">com</span>/callback/qq&amp;</span><br><span class="line">response_type=code&amp;state=<span class="number">0580</span>e4416bfe4e4e81611d7c3d08d655</span><br></pre></td></tr></table></figure>
<ul>
<li>response_type：这个值必须是 “code”，用于获取授权码(authorization code)；必选。</li>
<li>client_id：应用的 ID 名称；必选。</li>
<li>redirect_uri： 授权回调地址，必须和应用注册的地址一致；必选。</li>
<li>state：client端的状态值。用于第三方应用防止CSRF攻击，成功授权后回调时会原样带回。请务必严格按照流程检查用户与state参数状态的绑定；可选。</li>
<li>scope：应用申请权限的范围；可选。</li>
</ul>
<p>B. 用户在授权服务器返回的页面上选择是否给予此应用授权（用户必须显式同意或拒绝）。如第一幅图，QQ授权服务器返回一个界面，有应用想获取的资源，用户来决定是否给予这些授权。</p>
<p>C. 如果用户同意授权，认证服务器将用户转向应用已经指定的 重定向链接(redirection URI)，重定向链接包必须含一个授权码(authorization_code)；不同意则通过 重定向链接(redirection URI) 返回对应的 ERROR 信息。</p>
<p>D. 应用收到授权码，加上之前的重定向链接和认证应用身份的数据，访问认证服务器来获取授权令牌(Access Token)。</p>
<p>请求参数：</p>
<ul>
<li>grant_type: 授权类型，此值为：authorization_code，必选。</li>
<li>client_id: 分配给应用的appid，必选。</li>
<li>client_secret： 分配给应用的secret，必选。</li>
<li>redirect_uri：与上面一步中传入的redirect_uri保持一致，必选。</li>
<li>code：上一步返回的authorization_code，必选。</li>
<li>state：client端的状态值。用于第三方应用防止CSRF攻击，成功授权后回调时会原样带回。请务必严格按照流程检查用户与state参数状态的绑定。必选。</li>
</ul>
<p>E. 认证服务器收到 D 中的数据后，首先验证应用合法性，其次验证 redirect_uri 与 C 中的是否一致，验证通过后，返回授权令牌。</p>
<p>返回参数：</p>
<ul>
<li>access_token：授权令牌，必须。</li>
<li>expires_in：该access_token的有效期，必须。</li>
<li>refresh_token：在授权自动续期步骤中，获取新的Access_Token时需要提供的参数，必须。</li>
</ul>
</li>
</ol>
<h1 id="u91CD_u8981_u6587_u732E"><a href="#u91CD_u8981_u6587_u732E" class="headerlink" title="重要文献"></a>重要文献</h1><p><a href="http://www.rfcreader.com/#rfc6749" target="_blank" rel="external">The OAuth 2.0 Authorization Framework</a><br><a href="https://zh.wikipedia.org/wiki/OpenID" target="_blank" rel="external">OpenID</a></p>
</div><div class="tags"></div><div class="post-nav"><a href="http://www.happycode.org/2016/03/07/ssh-authorized/" class="pre"><i class="icon-previous">ssh免密码登陆</i></a><a href="http://www.happycode.org/2016/01/31/20to80/" class="next">《年薪20万到80万的进击》有感<i class="icon-next"></i></a></div><div data-thread-key="2016/02/21/oauth/" data-title="OAuth详解" data-url="http://www.happycode.org/2016/02/21/oauth/" class="ds-share flat"><div class="ds-share-inline"><ul class="ds-share-icons-16"><li data-toggle="ds-share-icons-more"><a href="javascript:void(0);" class="ds-more">分享到：</a></li><li><a href="javascript:void(0);" data-service="weibo" class="ds-weibo">微博</a></li><li><a href="javascript:void(0);" data-service="qzone" class="ds-qzone">QQ空间</a></li><li><a href="javascript:void(0);" data-service="qqt" class="ds-qqt">腾讯微博</a></li><li><a href="javascript:void(0);" data-service="wechat" class="ds-wechat">微信</a></li></ul><div class="ds-share-icons-more"></div></div></div><div data-thread-key="2016/02/21/oauth/" data-title="OAuth详解" data-url="http://www.happycode.org/2016/02/21/oauth/" data-author-key="1" class="ds-thread"></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search" class="search-form-input"/><input type="hidden" name="sitesearch" value="http://www.happycode.org"/></form></div><div class="widget"><div class="widget-title">分类</div></div><div class="widget"><div class="widget-title">标签</div><div class="tagcloud"><a href="http://www.happycode.org/tags/vim-markdown/" style="font-size: 15px;">vim markdown</a> <a href="http://www.happycode.org/tags/git/" style="font-size: 15px;">git</a></div></div><div class="widget"><div class="widget-title">最新文章</div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/03/07/ssh-authorized/">ssh免密码登陆</a></li><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/02/21/oauth/">OAuth详解</a></li><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/01/31/20to80/">《年薪20万到80万的进击》有感</a></li><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/01/30/git-config/">同时管理多个git平台的ssh key</a></li><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/01/09/vim-markdown/">vim支持markdown高亮显示</a></li><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/01/08/docker/">Docker简介</a></li><li class="post-list-item"><a class="post-list-link" href="http://www.happycode.org/2016/01/08/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="comments-title">最近评论</div><div data-num-items="5" data-show-avatars="0" data-show-time="1" data-show-admin="0" data-excerpt-length="32" data-show-title="1" class="ds-recent-comments"></div></div><div class="widget"><div class="widget-title">友情链接</div><ul></ul><a href="http://www.oschina.net/" title="开源中国" target="_blank">开源中国</a><ul></ul><a href="https://segmentfault.com/" title="segmentfault" target="_blank">segmentfault</a><ul></ul><a href="https://www.v2ex.com/" title="V2EX" target="_blank">V2EX</a></div></div></div></div><div id="footer">© <a href="http://www.happycode.org/." rel="nofollow">技术博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div><a id="rocket" href="#top" class="show"></a><script src="http://www.happycode.org/js/jquery.min.js" type="text/javascript"></script>
<script src="http://www.happycode.org/js/totop.js" type="text/javascript"></script><script src="http://www.happycode.org/js/fancybox.pack.js" type="text/javascript"></script>
<script src="http://www.happycode.org/js/jquery.fancybox.js" type="text/javascript"></script><link rel="stylesheet" href="http://www.happycode.org/css/jquery.fancybox.css" type="text/css"><script>var duoshuoQuery = {short_name:'happycode'};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//dn-comment.qbox.me/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0]
        || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-73339936-1','auto');ga('send','pageview');
</script></div></body></html>